<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>University Exam Schedule - Student View</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <!-- Main container for the student interface -->
    <div class="container">
        <!-- Header section with title and description -->
        <header>
            <h1>ðŸ“š Exams</h1>
            <p>View your exam schedule simply</p>
        </header>

        <!-- Search Section - Core functionality for students -->
        <section class="search-section">
            <h2>Search Exams</h2>
            <div class="search-wrapper">
                <!-- Search input with real-time functionality -->
                <input type="text" id="searchInput" placeholder="Search by exam name...">
                <button id="searchBtn" class="search-btn">Search</button>
                <button id="clearSearch" class="clear-btn">Clear</button>
            </div>
            <!-- Search status messages -->
            <div id="searchStatus" class="search-status"></div>
        </section>

        <!-- Exam Schedule Display Section -->
        <section class="schedule-section">
            <h2>Exam Schedule</h2>
            <!-- Exam count display -->
            <div id="examCount" class="exam-count"></div>
            
            <!-- Table container for responsive design -->
            <div class="table-container">
                <table id="examTable" class="exam-table">
                    <thead>
                        <tr>
                            <th>Exam</th>
                            <th>Date</th>
                            <th>Start Time</th>
                            <th>Duration</th>
                            <th>Room</th>
                            <th>Student Split</th>
                        </tr>
                    </thead>
                    <tbody id="examTableBody">
                        <!-- Exam data will be dynamically populated here via JavaScript -->
                    </tbody>
                </table>
            </div>
            
            <!-- Message shown when no exams are available -->
            <div id="noExams" class="no-exams">
                <p>No exams available yet. Please check back later.</p>
            </div>
        </section>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>Andrew Maklakov&copy; 2025 Exam Schedule App, Built with Flask & Python</p>
    </footer>

    <script>
        
        // Event listeners for search functionality
        document.getElementById('searchBtn').addEventListener('click', () => search());
        document.getElementById('searchInput').addEventListener('input', () => search()); // Real-time search
        document.getElementById('searchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') search(); // Search on Enter key
        });
        
        // Clear search functionality
        document.getElementById('clearSearch').addEventListener('click', () => {
            document.getElementById('searchInput').value = '';
            document.getElementById('searchStatus').style.display = 'none';
            loadExams(); // Load all exams
        });

        // Load exams when page loads
        document.addEventListener('DOMContentLoaded', loadExams);

        // Perform search functionality
        // Handles both real-time search and button-triggered search
        // This is the same search logic as the admin view but without upload functionality
        
        async function search() {
            const query = document.getElementById('searchInput').value.trim();
            
            if (query === '') {
                // If no query, hide status and load all exams
                document.getElementById('searchStatus').style.display = 'none';
                loadExams();
            } else {
                try {
                    // Send search request to API
                    const response = await fetch(`/api/exams/search?q=${encodeURIComponent(query)}`);
                    const exams = await response.json();
                    
                    // Display search results
                    displayExams(exams);
                    
                    // Show search status message
                    showSearchStatus(exams.length === 0 ? 
                        `No results for "${query}"` : 
                        `Found ${exams.length} result(s) for "${query}"`, 
                        exams.length === 0 ? 'warning' : 'success');
                } catch (error) {
                    showSearchStatus('Search failed', 'error');
                }
            }
        }

        // Load all exams from the database
        // Called on page load to display the complete exam schedule
        
        async function loadExams() {
            try {
                const response = await fetch('/api/exams');
                const exams = await response.json();
                displayExams(exams);
            } catch (error) {
                console.error('Error loading exams:', error);
            }
        }

        // Display exams in the table
        // Handles both showing exam data and empty state
        // Array of exam objects to display
        
        function displayExams(exams) {
            const tableBody = document.getElementById('examTableBody');
            const noExamsDiv = document.getElementById('noExams');
            const examCountDiv = document.getElementById('examCount');
            const table = document.getElementById('examTable');
            
            if (exams.length === 0) {
                // No exams to display - show empty state
                table.style.display = 'none';
                noExamsDiv.style.display = 'block';
                examCountDiv.textContent = '';
            } else {
                // Display exams in table
                table.style.display = 'table';
                noExamsDiv.style.display = 'none';
                examCountDiv.textContent = `Showing ${exams.length} exam(s)`;
                
                // Generate HTML for each exam row
                tableBody.innerHTML = exams.map(exam => `
                    <tr>
                        <td>${exam.course_code || '-'}</td>
                        <td>${exam.exam_date || '-'}</td>
                        <td>${exam.start_time || '-'}</td>
                        <td>${exam.duration || '-'}</td>
                        <td>${exam.room || '-'}</td>
                        <td>${exam.student_split || '-'}</td>
                    </tr>
                `).join('');
            }
        }

        // Show search status messages
        // Provides feedback to users about search results
        // Message to display
        // Type of message ('success', 'warning', 'error')
        function showSearchStatus(message, type) {
            const div = document.getElementById('searchStatus');
            div.textContent = message;
            div.className = `search-status ${type}`;
            div.style.display = 'block';
        }
    </script>
</body>
</html> 